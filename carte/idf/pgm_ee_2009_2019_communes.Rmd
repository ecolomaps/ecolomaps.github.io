---
title: "Evolution du vote aux européennes de 2009 et 2019 dans le Val de Marne"
author: "Claude GRASLAND"
date: "16/11/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE,message=FALSE,comment=FALSE, warning=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#library(sp)
library(sf)
library(dplyr)
library(cartography)
```

## INTRODUCTION

Je propose une analyse de l'évolution du vote au élections européennes dans le Val-de-Marne entre 2009 et 2019. L'étude est menée à l'échelle des communes car les bureaux de votes ont changé ...

**ATTENTION : DONNEES A VERIFIER**

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}

ee09<-read.csv("data/vdm_ee_09_simp.csv", header=T, sep=";",dec=",",stringsAsFactors = F)
ee09_com<- ee09  %>% group_by(COM) %>%
           summarise(COM_NOM=min(COM_NOM),
                     VOT09_ABS = sum(VOT09_ABS*INSCRITS09)/sum(INSCRITS09),
                     VOT09_BLNUL = sum(VOT09_BLNUL*VOTANTS09)/sum(VOTANTS09),
                     VOT09_EXGAU = sum(VOT09_EXGAU*EXPRIM09)/sum(EXPRIM09),
                     VOT09_GAUCH = sum(VOT09_GAUCH*EXPRIM09)/sum(EXPRIM09),
                     VOT09_ECOLO = sum(VOT09_ECOLO*EXPRIM09)/sum(EXPRIM09),
                     VOT09_CENTR = sum(VOT09_CENTR*EXPRIM09)/sum(EXPRIM09),
                     VOT09_DROIT = sum(VOT09_DROIT*EXPRIM09)/sum(EXPRIM09),       
                     VOT09_EXDRO = sum(VOT09_EXDRO*EXPRIM09)/sum(EXPRIM09),
                     INSCRITS09 = sum(INSCRITS09),
                     ABST09 = sum(ABST09),
                     VOTANTS09 = sum(VOTANTS09),
                     BLCNULS09 = sum(BLCNUL09),
                     EXPRIM09 = sum(EXPRIM09),
                     )

ee19<-read.csv("data/vdm_ee_19_simp.csv", header=T, sep=";",dec=",",stringsAsFactors = F)
ee19_com<- ee19  %>% group_by(COM) %>%
           summarise(COM_NOM=min(COM_NOM),
                     VOT19_ABS = sum(VOT19_ABS*INSCRITS19)/sum(INSCRITS19),
                     VOT19_BLNUL = sum(VOT19_BLNUL*VOTANTS19)/sum(VOTANTS19),
                     VOT19_EXGAU = sum(VOT19_EXGAU*EXPRIM19)/sum(EXPRIM19),
                     VOT19_GAUCH = sum(VOT19_GAUCH*EXPRIM19)/sum(EXPRIM19),
                     VOT19_ECOLO = sum(VOT19_ECOLO*EXPRIM19)/sum(EXPRIM19),
                     VOT19_CENTR = sum(VOT19_CENTR*EXPRIM19)/sum(EXPRIM19),
                     VOT19_DROIT = sum(VOT19_DROIT*EXPRIM19)/sum(EXPRIM19),       
                     VOT19_EXDRO = sum(VOT19_EXDRO*EXPRIM19)/sum(EXPRIM19),
                     INSCRITS19 = sum(INSCRITS19),
                     ABST19 = sum(ABST19),
                     VOTANTS19 = sum(VOTANTS19),
                     BLCNULS19 = sum(BLCNUL19),
                     EXPRIM19 = sum(EXPRIM19),
                     )


tab<-merge(ee09_com,ee19_com[,-2],by="COM",all.x=F,all.y=F)
tab$myvar<-1
tab$stock<-1
tab$varia<-"gain"

map_com<-st_read("geom/vdm_surf_com.shp", quiet=T)


map<-merge(map_com,tab,by.x="id",by.y="COM",all.x=F,all.y=F)




```



# 1. ANALYSE GENERALE DE L'EVOLUTION PAR FAMILLES POLITIQUES

Bien que cela puisse prêter à discussion, j'ai opté pour un regroupements des forces politiques selon la grille d'analyse classique Droite-Gauche, exception faite du courant écologiste. Il serait en effet difficile de cartographier à chaque date l'ensemble des listes et encore plus de mettre en évidence les évolutions.


## 1. Participation électorale 

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-100-tab$VOT09_ABS
V2019<-100-tab$VOT19_ABS
code<-paste(tab$COM_NOM)
mytitle<-"Taux de participation"

```






### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "taupe.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "taupe.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```









## 2. Vote "écologiste"

Regroupe à chaque date le vote EELV et les listes dites "écologistes" comme celle de D. Bourg ou le parti animaliste en 2019.

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-tab$VOT09_ECOLO
V2019<-tab$VOT19_ECOLO
code<-paste(map$COM_NOM)
mytitle<-"Vote EELV & autres écolos"

```






### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "green.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "green.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019
```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```


### Variation brute

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}
stock1<-V2009*tab$VOTANTS09/100
stock2<-V2019*tab$VOTANTS19/100
map$stock<-abs(stock2-stock1)
map$varia<-"pertes"
map$varia[stock2>stock1]<-"gains"

par(mfrow=c(1,1),mar=c(0,0,2,0))
plot(map_com$geometry,col="gray80")
plot(map$geometry,add=T,col="lightyellow",lwd=0.3)
plot(map_com$geometry,col=NA,lwd=1,add=T)
propSymbolsTypoLayer(spdf=map,
                 fixmax = 200,
                 inches = 0.1,
                 var = "stock",
                 var2 = "varia",
                 col=c("blue","red"),
                 legend.var.pos="topleft",
                 legend.var.title.txt = "nb. de votes",
                 legend.var.style = "e",
                 legend.values.rnd = 0)
layoutLayer( title = paste(mytitle," - gains ou pertes de voix entre 2009 et 2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")

```


## 3. Vote "extrême gauche"

Regroupe les vote PCF, Front de Gauche, France Insoumise, LCR, ...

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-tab$VOT09_EXGAU
V2019<-tab$VOT19_EXGAU
code<-paste(map$COM_NOM)
mytitle<-"Vote Extrême Gauche"

```


### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "red.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "red.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Variation brute

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}
stock1<-V2009*tab$VOTANTS09/100
stock2<-V2019*tab$VOTANTS19/100
map$stock<-abs(stock2-stock1)
map$varia<-"pertes"
map$varia[stock2>stock1]<-"gains"

par(mfrow=c(1,1),mar=c(0,0,2,0))
plot(map_com$geometry,col="gray80")
plot(map$geometry,add=T,col="lightyellow",lwd=0.3)
plot(map_com$geometry,col=NA,lwd=1,add=T)
propSymbolsTypoLayer(spdf=map,
                 fixmax = 200,
                 inches = 0.1,
                 var = "stock",
                 var2 = "varia",
                 col=c("blue","red"),
                 legend.var.pos="topleft",
                 legend.var.title.txt = "nb. de votes",
                 legend.var.style = "e",
                 legend.values.rnd = 0)
layoutLayer( title = paste(mytitle," - gains ou pertes de voix entre 2009 et 2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")

```



## 4. Vote "Socialiste"

Regroupe les votes PS et radicaux de gauche en 2009, puis Hamon et Glucksman en 2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-tab$VOT09_GAUCH
V2019<-tab$VOT19_GAUCH
code<-paste(map$COM_NOM)
mytitle<-"Vote socialiste"

```


### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "pink.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "pink.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}
stock1<-V2009*tab$VOTANTS09/100
stock2<-V2019*tab$VOTANTS19/100
map$stock<-abs(stock2-stock1)
map$varia<-"pertes"
map$varia[stock2>stock1]<-"gains"

par(mfrow=c(1,1),mar=c(0,0,2,0))
plot(map_com$geometry,col="gray80")
plot(map$geometry,add=T,col="lightyellow",lwd=0.3)
plot(map_com$geometry,col=NA,lwd=1,add=T)
propSymbolsTypoLayer(spdf=map,
                 fixmax = 200,
                 inches = 0.1,
                 var = "stock",
                 var2 = "varia",
                 col=c("red","blue"),
                 legend.var.pos="topleft",
                 legend.var.title.txt = "nb. de votes",
                 legend.var.style = "e",
                 legend.values.rnd = 0)
layoutLayer( title = paste(mytitle," - gains ou pertes de voix entre 2009 et 2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")

```

## 5. Vote "centriste"

Regroupe le vote MODEM en 2009 puis les vote Loiseau et Lagarde en 2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-tab$VOT09_CENTR
V2019<-tab$VOT19_CENTR
code<-paste(map$COM_NOM)
mytitle<-"Vote centriste"

```


### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "orange.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "orange.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019
```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}
stock1<-V2009*tab$VOTANTS09/100
stock2<-V2019*tab$VOTANTS19/100
map$stock<-abs(stock2-stock1)
map$varia<-"pertes"
map$varia[stock2>stock1]<-"gains"

par(mfrow=c(1,1),mar=c(0,0,2,0))
plot(map_com$geometry,col="gray80")
plot(map$geometry,add=T,col="lightyellow",lwd=0.3)
plot(map_com$geometry,col=NA,lwd=1,add=T)
propSymbolsTypoLayer(spdf=map,
                 fixmax = 200,
                 inches = 0.1,
                 var = "stock",
                 var2 = "varia",
                 col=c("blue","red"),
                 legend.var.pos="topleft",
                 legend.var.title.txt = "nb. de votes",
                 legend.var.style = "e",
                 legend.values.rnd = 0)
layoutLayer( title = paste(mytitle," - gains ou pertes de voix entre 2009 et 2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")

```

## 6. Vote "Droite"

Regroupe les votes UMP en 2009 et Les Républicains en 2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-tab$VOT09_DROIT
V2019<-tab$VOT19_DROIT
code<-paste(map$COM_NOM)
mytitle<-"Vote Droite classique"

```

### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "blue.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "blue.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}
stock1<-V2009*tab$VOTANTS09/100
stock2<-V2019*tab$VOTANTS19/100
map$stock<-abs(stock2-stock1)
summary(map$stock)
map$varia<-"pertes"
map$varia[stock2>stock1]<-"gains"
table(map$varia)

par(mfrow=c(1,1),mar=c(0,0,2,0))
plot(map_com$geometry,col="gray80")
plot(map$geometry,add=T,col="lightyellow",lwd=0.3)
plot(map_com$geometry,col=NA,lwd=1,add=T)
propSymbolsTypoLayer(spdf=map,
                 fixmax = 200,
                 inches = 0.1,
                 var = "stock",
                 var2 = "varia",
                 col=c("red","blue"),
                 legend.var.pos="topleft",
                 legend.var.title.txt = "nb. de votes",
                 legend.var.style = "e",
                 legend.values.rnd = 0)
layoutLayer( title = paste(mytitle," - gains ou pertes de voix entre 2009 et 2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")

```

## 7. Vote "Extrême Droite

Regroupe le FN/RN, Dupont-Aignan, Asselineau, Philippot ... 

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=6}
V2009<-tab$VOT09_EXDRO
V2019<-tab$VOT19_EXDRO
code<-paste(map$COM_NOM)
mytitle<-"Vote Extrême Droite"

```

### Situation en 2009 et 2019


```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(0,0,2,0))
map$myvar<-V2009
cols <- carto.pal(pal1 = "kaki.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title = paste(mytitle,"- (2009)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")




map$myvar<-V2019
cols <- carto.pal(pal1 = "kaki.pal", n1 = 6)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 6,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method ="q6",
           border = "grey40",
           legend.pos = "topleft",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)

# Layout plot
layoutLayer( title =  paste(mytitle,"- (2019)"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

### Tendance 2009-2019

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=4,fig.width=8}
par(mfrow=c(1,2),mar=c(2,2,2,0))
### tendance
min<-min(min(V2009),min(V2019))
max<-max(max(V2009),max(V2019))
mod<-lm(V2019 ~ V2009)
plot(V2009,V2019,cex=0, xlim=c(min,max),ylim=c(min,max),
     main=paste("V2019 =",round(mod$coefficients[2],2)," x V2009 + ",round(mod$coefficients[1],2)))
text(V2009,V2019,code,cex = 0.6)
abline(mod,col="red")
abline(a=0,b=1,col="blue")


### Ecart à la tendance 2009-2019
map$myvar<-mod$residuals
cols <- carto.pal(pal1 = "orange.pal", n1 = 4,pal2 = "green.pal",n2=4)
# Prépare une palette à double gamme colorée
plot(map_com$geometry,col="gray90")
choroLayer(spdf = map,
           nclass = 8,
           var = "myvar",
           lwd =0.3,
           col = cols,
           method="em",
           border = "grey40",
           legend.pos = "topright",
           legend.title.txt = "%",
           legend.values.rnd = 2,
           add=T)
plot(map_com$geometry,col=NA,add=T,lwd=0.6)
?choroLayer
# Layout plot
layoutLayer( title = paste(mytitle," - écarts à la tendance 2009-2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")
```

```{r, cache.comments=F,comment=F,message=F, comment = F,error=FALSE,echo=F, fig.height=6,fig.width=8}
stock1<-V2009*tab$VOTANTS09/100
stock2<-V2019*tab$VOTANTS19/100
map$stock<-abs(stock2-stock1)
summary(map$stock)
map$varia<-"pertes"
map$varia[stock2>stock1]<-"gains"

par(mfrow=c(1,1),mar=c(0,0,2,0))
plot(map_com$geometry,col="gray80")
plot(map$geometry,add=T,col="lightyellow",lwd=0.3)
plot(map_com$geometry,col=NA,lwd=1,add=T)
propSymbolsTypoLayer(spdf=map,
                 fixmax = 200,
                 inches = 0.1,
                 var = "stock",
                 var2 = "varia",
                 col=c("blue","red"),
                 legend.var.pos="topleft",
                 legend.var.title.txt = "nb. de votes",
                 legend.var.style = "e",
                 legend.values.rnd = 0)
layoutLayer( title = paste(mytitle," - gains ou pertes de voix entre 2009 et 2019"),
            sources = "Source : Ministère de l'intérieur",
            author = "(c) Claude Grasland, EELV Haut Val de Marne",
            scale = NULL,
            frame = TRUE,
            col = "black",
            coltitle = "white")

```


